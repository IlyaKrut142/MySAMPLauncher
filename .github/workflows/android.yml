name: Android Build

on:
  push:
    branches: [ "main" ]
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v4

    - name: set up JDK 11
      uses: actions/setup-java@v4
      with:
        java-version: '11'
        distribution: 'temurin'

    - name: Build with Global Gradle
      run: |
        # –≠—Ç–∞ –∫–æ–º–∞–Ω–¥–∞ –Ω–∞–π–¥–µ—Ç, –≤ –∫–∞–∫–æ–π –ø–∞–ø–∫–µ –ª–µ–∂–∏—Ç –ø—Ä–æ–µ–∫—Ç, –∏ –∑–∞–ø—É—Å—Ç–∏—Ç —Å–±–æ—Ä–∫—É —Ç–∞–º
        # –î–∞–∂–µ –µ—Å–ª–∏ —Ñ–∞–π–ª—ã —Å–ø—Ä—è—Ç–∞–Ω—ã –≥–ª—É–±–æ–∫–æ –≤ –ø–∞–ø–∫–∞—Ö
        
        echo "üîç –ò—â–µ–º —Ñ–∞–π–ª build.gradle..."
        BUILD_FILE=$(find . -name build.gradle | head -n 1)
        
        if [ -z "$BUILD_FILE" ]; then
          echo "‚ùå –û—à–∏–±–∫–∞: –§–∞–π–ª build.gradle –Ω–µ –Ω–∞–π–¥–µ–Ω! –í—ã —Ç–æ—á–Ω–æ –∑–∞–≥—Ä—É–∑–∏–ª–∏ —Ñ–∞–π–ª—ã?"
          ls -R
          exit 1
        fi
        
        PROJECT_DIR=$(dirname "$BUILD_FILE")
        echo "‚úÖ –ü—Ä–æ–µ–∫—Ç –Ω–∞–π–¥–µ–Ω –≤ –ø–∞–ø–∫–µ: $PROJECT_DIR"
        
        cd "$PROJECT_DIR"
        
        echo "üöÄ –ó–∞–ø—É—Å–∫–∞–µ–º —Å–±–æ—Ä–∫—É —á–µ—Ä–µ–∑ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π Gradle..."
        gradle assembleDebug --no-daemon
    
    - name: Upload APK
      if: success()
      uses: actions/upload-artifact@v4
      with:
        name: my-samp-launcher
        path: '**/*.apk'
